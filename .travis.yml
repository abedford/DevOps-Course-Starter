services:
- docker
install:
- wget https://releases.hashicorp.com/terraform/"$TF_VERSION"/terraform_"$TF_VERSION"_linux_amd64.zip
- unzip terraform_"$TF_VERSION"_linux_amd64.zip
- sudo mv terraform /usr/local/bin/
- rm terraform_"$TF_VERSION"_linux_amd64.zip
- terraform init -input=false
script:
- docker build --tag todo-app-dev --target development .
- docker build --tag todo-app-test --target test .
- docker run -e MONGO_CONNECTION -e MONGO_DB -e MONGO_PWD -e MONGO_SRV -e MONGO_USER
  todo-app-test todo_app/tests_e2e
- docker run --env-file .env.test todo-app-test todo_app/tests
- bash webhook.sh
before_deploy:
- terraform apply -input=false -var 'prefix=test' -auto-approve
deploy:
  skip_cleanup: true
  provider: script
  script: bash docker_push.sh
  on:
    branch: main
notifications:
  slack:
    secure: HJQ/XLQJ4fgGY53qi/UMQ0waUvL+gyKKMUoBj8cCOF2P8zzxGw8/fpWAFaivyqfjs1qRrSX4tg+YBWkmTsJ/MQpKBlPNyUtwfaMbYlQCMaDk15jbkyisehgUDac0djOhyuHgaZMeXOpH+U3O7n1tOxigY7ey57GgMQv8gxHtaMhT/qLP/bokMy1QplVlzg2+OAAp0lUS1B76GWTLd498DDifukvBKMqq3nnEW6s3iGMCP2zG/SNUWfFHcZcilWQzT5XGqZ2/fKr20ROGR56UB6uC75fHx4s1gobz345MmsrvmeBa7ptHnNL/3JFxTM7cW52jQfvYeekHwJY/ScnGAM2/1sXkLpFiQN8yqydbd0o7/7rWdEGEWIaT3/bXg+RW213rYOV3h5vAJcUYKYAiDH29xMxXI29LoQet/oe2gxVPFORQ0kj3QJ9Tk2VvlnhFKjjvuCl2mZfVxocmZUNbJykd9cEkANKhyUvuQG94kQ4zP8e7y7pdUpLhViTlKN0WgKRxxADK54VWMgZIxYCtx8TUOPTBLKSQhcO5e/Cri57dpgoo8dPNZg8A3tmdHpctuwTWCkiFd/VLzaB4En+QggDitIDu2t9g/uSwI6Q0EokyQFw0j8qNA5tHQmhO5NiHJSEVAv7ceV0hMUL4AG/EJ3I4GDk3p1i6HeOTJUxkMLQ=
env:
  global:
  - TF_VERSION=0.14.7
  - secure: DY0cAS25m6LeX9FxYWwSdXR2kBx/6A1xBk+V6RMxCXCIMXpbxjXGcdxY0SPjpmqg2AjjM1csCRhdGtWkZqAESKCjUQbyHlHJde5jmx3pwkouN6oimx7SaDws4KgVGTgjBfhNJoQDSkIOy9I7+aUHVHVrboa1xFY/7Cid5SvSA1ekP0u4xeE2tXvUqaI3MbE25rOF34nZR6kqjlQGZGGzd042cEvG4y41IHeLPZfjELMzphkSHgXKNyLh39mBnhv3gUxSV6O0u7o/KZBrK8wTBXvQAZF8BnYK/CKiBTazKjttLUovTKTE9XgUnJ/DjhngylNoV8Y6D0/6jxDnJRDM1G5mtTVsQmu/mZ5aDl80UN+kVI1HdkLFRg1V3Qlp31D0EL3oX0NouaDbaBytg+vB2u5Vn9zkFiw7KMGyIgCKnk17mBsDrmYfsgs8l0yuKtl7t1ea3dhWeM2LVLAbhtiEqkX71OAlgZxEl8aAla55ZTDYyiq8zSNHv2t+bDBE5XSk0ZztH/U1LvQ0Ntcs3Dih0EPA0hiIQ/SInqxzM7EHFxffqwLR8etO86zYvlsQIQ8txVnedWnj5wn5oKQysRikpRZUbOCf0V08TqhkSoc4e6HS52cGJ0ZH48zhIXNSrOUGwOL+Sh6Maoc5L/M3BbI37hRYmVWafERNTzAQeMDm/aY=
  - secure: CiEaZfDWVQfAcjr/PQTonN+w9UXf0ocdqknYlyMffF0aNpBR9WokZF+OTpxDCEZ/sRiSjoT4PkyH3c0SvcbRCjQEpmeYvvtP/tZZOZ9kTWwBFDgf3WjKhp29juUb9L8ioGhtjHiCTLpa/9qUELBGuXOXeJjXo+umwxe2YIaMRsl9qaAXOke1i5dAWl4IIWvV/M0Mos533PnAPf1A4W9uHdPZWBjgJ7N0WgSYwox/Yjzhs+K6T2d6L5i/WZEa93dk9ocZfciedBJdiTXeR65NxP8tLDptHRpclKAfomHBARJVqG2yZoRNilLlM172hc6xdIIMk5yPOTeCK8nKycGRilYVnZ5vJuMt8l5cDglaYy4DT+rTtOGE5uCQLzzW4Mav8eK/PxIaNLLmwa/EUc7+3cPt47wbdg2LyPs6sWG6yJ6g9h8mX868+idDdntD1ncDDZJwasaVGgCeKlyXA9yeRo0Tv+1kLz2MhAin8zFNb6duveQCsVgZbRJgUZWmECap7JGdI8Pz0HisWZ8NPVeoKmlR/novT6/T1KJa3pHa+zUF7g+U3SmBcRHnl2XA26VC5LayklpMk3GrsqROHloGCDaD5F4jFIn6UV2fByud7BTwE8e9VRQ9/fh57bdpBhiHoAL6XFxD3+oByy67y7NsIBq52Uag4t0aJma3XMuzIpg=
  - secure: gQ1hBf8iopyddzCAeWJi5nyqK/J4JCk6my0/UOP7WE+4H7rhJnIn+4A71nK6j0iGucprkakBdQDB1TeaVBS4gRLH9kzbvXlCThDwD0o/QWC9F2YiEnZ2wWaGjZVUdYipy8tU86NX0F3BcEwqYAHnElRMpY3pDyQlGAxuxRE7ZnwQeTtmaE1FcPso1sZUfUKHsH41XYw36AaWpjNez+zpsJYma9lM+HLQKeFrRnp+4X1wPW85omB1bSeZcL8n9MyOQD3rt6QSHkH+fajYwmJ6B4WPG1A7ivYIbpnJ521u+W58P3/mYWMfwijLDa2HW67hF/kB2nUXBYvwarsIybRXCfWjrsyTJpCofAoAUlLTxHNTE6aV15d3LSIWpNd1mJqpdhUDU9D44YqeOgD0Vc6ngxoG9T6tFI/Kyu0QJIJl62+U057SUGsdwpUJqjdgFGyOM8nADYT4e2ZyHMjBDXXB80kQ95EScSTQfA3+rbLLdXjFMPtwVhbeYJTkd4yd9txMsUr5cg2Qglobt/TYVGPNECMz11xcbVesfvmsgeuFUIyy13slFXYZ9xStC3pAmGcaLDWlZViAjngVrs6YolPQyQaPrF4341ExxzhzMdgqvT2kpx3L8mQBqsiOjatOThtFRP9vhvXXiXh79CWhs0qvQKQzKI5H8GDdZOwhhmWEvls=
  - secure: hrHpIQb/dEbQOyl40jSzeFQaVKgDJqFN+3xNpeb8DMsVvvjQ9advmefbHs7Urz0oNalmwqu79k3C8U7Zeavy6D07HcWeam/FbSTGz1v0ouGIqnpCbdybIC6qgUMZgxP+R/hLhyjNRKXn4K+T8bIPN03dZRAIk5PHmK+hUcJg/JaxBGAXzOTCDCB3gablE84mPO/TIfj5otlP4zGzaX6qdmh623AhLIb81SYKdEky7zHQGlWVOZBFL16N0MjdaINSm79c9DmGE44fp0iSgYdK0J0zQcza4Arj4pUao/l3dbA0VhxX7YnYxxkflGPUPkJWXhn5aJQJiCQoGOSLOIddb2GbiE+5Ai+eGFn09sAVdhsw1opyC96/UtpzbupQCIwYIbCZh1ZlEY8JHmsxnR+gzt3p4MhgRVvbhcKC4Tpff14JvW2RFuz1meisezRbdR0wiRZCk2d8zNE2Joe1lvkAm2vwBmTT69Og6ejILs7JHXufOev8lIqqCGs856pRsIFnN40UbUDrVhJ9eSXMHcl9QOsMJW6AbaNLUrcIKv5xzbDTUgmKyxhqjp7mo3Vnmg0emZOKG+lwne3Y0eWmgAxXG1UUMtH76foK1AJxF81yInP1FNhppzI/2+CUHQGXulYeLy7UyFNTieGTylAwXyMiFxs0Q5mHWZufq3QN/KVYG/w=
  - secure: XvH0sLi3/b9okeneNbgT6+EHNnNIOay1Zz9ynciOENR4lFUG/PIGHnehtXZHUHE2ghTXG/e0LdnaJBlbylPsqRa4iqde8hP6t5Fz/U3lGTo6kWLQ/Z2VLcxarNFvjQ5LpXhvzqREO+WVdoyWDzBm4hP+Jvzfpgda5YuKj2EjsnHYNtyc3KdRaVu0W+DDo5IBhl0JGntDxBpeuY5t3d8NyaoOBuevSYzY2bJa/SJYfo+3+ODvL6UGKdnVq3IJHdB8jsQickjy5reCAf8pwXBqV85ICX0xxWn2yfPLQMzkn9HmrmI8WaD330iXXtCxTdd37KEkCH1TpddWG6zuGXbbLhyLY1tOeTVJOIY1k69yAAHumQzd+2RFYZ5kHwzKCVDsRVVGoxUiOu98C2qLnYZJaJZtaRgG9+be/yxpSbZynTdbWOVXIkTiUQb8RxURNiOgjmegviseFwvaXn2+EWkYAMcAU4Q3/FQwu19emN71wFPzJrnws+TOKXrgKJDmWk3JjO8Xv0ZJuLB45+oJRNWmZ9xILK8ASEk0pvkgD7AP1mciy/9aCU/yAU8c+8FY2BvAMcZ10HMelVCtFGYX3AQ6lghdn4IpcvRgfHLsL9pzGi1zdpmazm2Yt4/TaxOXgpDqJjOwCLt5A3JMqAdmzRk8MRrioEMtBiUZcAQXjqITrfk=
  - secure: gOXIhVxRR1TFjnzXwJm6GVWZNDYa9WCQPuIHq1/ugFPyGb/80k8joE22nWvK1VxrbdII8nrllDwG5j9DnkjddCi4LoFUKhG4061LMHyXKVoU6UkGcipOEsiEdcnbPNVXZ+rtwNND3irqw8Kkj2KZRGRo28UC+MvMWCwNbm/v6SGFLB+hZIENTF2e/c/P7568rA904S4Q/ZnLjei0ZYOUNj/NnC5EngzMczHSfq4YLNU2b4NQMyCfxrhINM0HOZpIag4v5OWA6WKnmsub4WEMqJx6TdU22MU6t+7fZ5W4g4nmFMGYGJooahWXeAguYAEU4z6LiLS96/IHWUH4HUBSRnadhrrxzWFUxwpL8DCKqP3UUlYcLv1mSQuF7A/PFUkLM7fwGUqA1HYYpekJ/nmJtmKkVxds9/HdATIBAoW+Zy/01Jjk6Su4ajVJzzfyhHKdU9uKZnXHRMranr9Ncur7N7hu95oARxGFfkpv2J7HpgkWCYhYNJlTQSKfz1VAxvmdyVjAJlAa1GLHztL20LqRWQdeCEa2VASRTSp0hci/PXuK5zM07oKGnsBX2NgrJ8AvYzi9wnQkLly2ht5IV1Lk7E7SutUD36HRz8kqpEZGjlP5SCeaj0Z45EJwKY8TprteINJjJsMcitqHKdqtP1YB7RtZm6ICWyHcarB4iO4B6rw=
