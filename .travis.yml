services:
- docker
install:
- wget https://releases.hashicorp.com/terraform/"$TF_VERSION"/terraform_"$TF_VERSION"_linux_amd64.zip
- unzip terraform_"$TF_VERSION"_linux_amd64.zip
- sudo mv terraform /usr/local/bin/
- rm terraform_"$TF_VERSION"_linux_amd64.zip
- terraform init -input=false
script:
- docker build --tag todo-app-dev --target development .
- docker build --tag todo-app-test --target test .
- docker run -e MONGO_CONNECTION -e MONGO_DB -e MONGO_PWD -e MONGO_SRV -e MONGO_USER
  -e LOGGLY_TOKEN -e LOG_LEVEL -e FLASK_SKIP_LOGIN todo-app-test todo_app/tests_e2e
- docker run --env-file .env.test todo-app-test todo_app/tests
- bash webhook.sh
before_deploy:
- terraform apply -input=false -var 'prefix=test' -auto-approve
deploy:
  skip_cleanup: true
  provider: script
  script: bash docker_push.sh
  on:
    branch: main
notifications:
  slack:
    secure: HJQ/XLQJ4fgGY53qi/UMQ0waUvL+gyKKMUoBj8cCOF2P8zzxGw8/fpWAFaivyqfjs1qRrSX4tg+YBWkmTsJ/MQpKBlPNyUtwfaMbYlQCMaDk15jbkyisehgUDac0djOhyuHgaZMeXOpH+U3O7n1tOxigY7ey57GgMQv8gxHtaMhT/qLP/bokMy1QplVlzg2+OAAp0lUS1B76GWTLd498DDifukvBKMqq3nnEW6s3iGMCP2zG/SNUWfFHcZcilWQzT5XGqZ2/fKr20ROGR56UB6uC75fHx4s1gobz345MmsrvmeBa7ptHnNL/3JFxTM7cW52jQfvYeekHwJY/ScnGAM2/1sXkLpFiQN8yqydbd0o7/7rWdEGEWIaT3/bXg+RW213rYOV3h5vAJcUYKYAiDH29xMxXI29LoQet/oe2gxVPFORQ0kj3QJ9Tk2VvlnhFKjjvuCl2mZfVxocmZUNbJykd9cEkANKhyUvuQG94kQ4zP8e7y7pdUpLhViTlKN0WgKRxxADK54VWMgZIxYCtx8TUOPTBLKSQhcO5e/Cri57dpgoo8dPNZg8A3tmdHpctuwTWCkiFd/VLzaB4En+QggDitIDu2t9g/uSwI6Q0EokyQFw0j8qNA5tHQmhO5NiHJSEVAv7ceV0hMUL4AG/EJ3I4GDk3p1i6HeOTJUxkMLQ=
env:
  global:
  - TF_VERSION=0.14.7
  - secure: DY0cAS25m6LeX9FxYWwSdXR2kBx/6A1xBk+V6RMxCXCIMXpbxjXGcdxY0SPjpmqg2AjjM1csCRhdGtWkZqAESKCjUQbyHlHJde5jmx3pwkouN6oimx7SaDws4KgVGTgjBfhNJoQDSkIOy9I7+aUHVHVrboa1xFY/7Cid5SvSA1ekP0u4xeE2tXvUqaI3MbE25rOF34nZR6kqjlQGZGGzd042cEvG4y41IHeLPZfjELMzphkSHgXKNyLh39mBnhv3gUxSV6O0u7o/KZBrK8wTBXvQAZF8BnYK/CKiBTazKjttLUovTKTE9XgUnJ/DjhngylNoV8Y6D0/6jxDnJRDM1G5mtTVsQmu/mZ5aDl80UN+kVI1HdkLFRg1V3Qlp31D0EL3oX0NouaDbaBytg+vB2u5Vn9zkFiw7KMGyIgCKnk17mBsDrmYfsgs8l0yuKtl7t1ea3dhWeM2LVLAbhtiEqkX71OAlgZxEl8aAla55ZTDYyiq8zSNHv2t+bDBE5XSk0ZztH/U1LvQ0Ntcs3Dih0EPA0hiIQ/SInqxzM7EHFxffqwLR8etO86zYvlsQIQ8txVnedWnj5wn5oKQysRikpRZUbOCf0V08TqhkSoc4e6HS52cGJ0ZH48zhIXNSrOUGwOL+Sh6Maoc5L/M3BbI37hRYmVWafERNTzAQeMDm/aY=
  - secure: CiEaZfDWVQfAcjr/PQTonN+w9UXf0ocdqknYlyMffF0aNpBR9WokZF+OTpxDCEZ/sRiSjoT4PkyH3c0SvcbRCjQEpmeYvvtP/tZZOZ9kTWwBFDgf3WjKhp29juUb9L8ioGhtjHiCTLpa/9qUELBGuXOXeJjXo+umwxe2YIaMRsl9qaAXOke1i5dAWl4IIWvV/M0Mos533PnAPf1A4W9uHdPZWBjgJ7N0WgSYwox/Yjzhs+K6T2d6L5i/WZEa93dk9ocZfciedBJdiTXeR65NxP8tLDptHRpclKAfomHBARJVqG2yZoRNilLlM172hc6xdIIMk5yPOTeCK8nKycGRilYVnZ5vJuMt8l5cDglaYy4DT+rTtOGE5uCQLzzW4Mav8eK/PxIaNLLmwa/EUc7+3cPt47wbdg2LyPs6sWG6yJ6g9h8mX868+idDdntD1ncDDZJwasaVGgCeKlyXA9yeRo0Tv+1kLz2MhAin8zFNb6duveQCsVgZbRJgUZWmECap7JGdI8Pz0HisWZ8NPVeoKmlR/novT6/T1KJa3pHa+zUF7g+U3SmBcRHnl2XA26VC5LayklpMk3GrsqROHloGCDaD5F4jFIn6UV2fByud7BTwE8e9VRQ9/fh57bdpBhiHoAL6XFxD3+oByy67y7NsIBq52Uag4t0aJma3XMuzIpg=
  - secure: gQ1hBf8iopyddzCAeWJi5nyqK/J4JCk6my0/UOP7WE+4H7rhJnIn+4A71nK6j0iGucprkakBdQDB1TeaVBS4gRLH9kzbvXlCThDwD0o/QWC9F2YiEnZ2wWaGjZVUdYipy8tU86NX0F3BcEwqYAHnElRMpY3pDyQlGAxuxRE7ZnwQeTtmaE1FcPso1sZUfUKHsH41XYw36AaWpjNez+zpsJYma9lM+HLQKeFrRnp+4X1wPW85omB1bSeZcL8n9MyOQD3rt6QSHkH+fajYwmJ6B4WPG1A7ivYIbpnJ521u+W58P3/mYWMfwijLDa2HW67hF/kB2nUXBYvwarsIybRXCfWjrsyTJpCofAoAUlLTxHNTE6aV15d3LSIWpNd1mJqpdhUDU9D44YqeOgD0Vc6ngxoG9T6tFI/Kyu0QJIJl62+U057SUGsdwpUJqjdgFGyOM8nADYT4e2ZyHMjBDXXB80kQ95EScSTQfA3+rbLLdXjFMPtwVhbeYJTkd4yd9txMsUr5cg2Qglobt/TYVGPNECMz11xcbVesfvmsgeuFUIyy13slFXYZ9xStC3pAmGcaLDWlZViAjngVrs6YolPQyQaPrF4341ExxzhzMdgqvT2kpx3L8mQBqsiOjatOThtFRP9vhvXXiXh79CWhs0qvQKQzKI5H8GDdZOwhhmWEvls=
  - secure: hrHpIQb/dEbQOyl40jSzeFQaVKgDJqFN+3xNpeb8DMsVvvjQ9advmefbHs7Urz0oNalmwqu79k3C8U7Zeavy6D07HcWeam/FbSTGz1v0ouGIqnpCbdybIC6qgUMZgxP+R/hLhyjNRKXn4K+T8bIPN03dZRAIk5PHmK+hUcJg/JaxBGAXzOTCDCB3gablE84mPO/TIfj5otlP4zGzaX6qdmh623AhLIb81SYKdEky7zHQGlWVOZBFL16N0MjdaINSm79c9DmGE44fp0iSgYdK0J0zQcza4Arj4pUao/l3dbA0VhxX7YnYxxkflGPUPkJWXhn5aJQJiCQoGOSLOIddb2GbiE+5Ai+eGFn09sAVdhsw1opyC96/UtpzbupQCIwYIbCZh1ZlEY8JHmsxnR+gzt3p4MhgRVvbhcKC4Tpff14JvW2RFuz1meisezRbdR0wiRZCk2d8zNE2Joe1lvkAm2vwBmTT69Og6ejILs7JHXufOev8lIqqCGs856pRsIFnN40UbUDrVhJ9eSXMHcl9QOsMJW6AbaNLUrcIKv5xzbDTUgmKyxhqjp7mo3Vnmg0emZOKG+lwne3Y0eWmgAxXG1UUMtH76foK1AJxF81yInP1FNhppzI/2+CUHQGXulYeLy7UyFNTieGTylAwXyMiFxs0Q5mHWZufq3QN/KVYG/w=
  - secure: XvH0sLi3/b9okeneNbgT6+EHNnNIOay1Zz9ynciOENR4lFUG/PIGHnehtXZHUHE2ghTXG/e0LdnaJBlbylPsqRa4iqde8hP6t5Fz/U3lGTo6kWLQ/Z2VLcxarNFvjQ5LpXhvzqREO+WVdoyWDzBm4hP+Jvzfpgda5YuKj2EjsnHYNtyc3KdRaVu0W+DDo5IBhl0JGntDxBpeuY5t3d8NyaoOBuevSYzY2bJa/SJYfo+3+ODvL6UGKdnVq3IJHdB8jsQickjy5reCAf8pwXBqV85ICX0xxWn2yfPLQMzkn9HmrmI8WaD330iXXtCxTdd37KEkCH1TpddWG6zuGXbbLhyLY1tOeTVJOIY1k69yAAHumQzd+2RFYZ5kHwzKCVDsRVVGoxUiOu98C2qLnYZJaJZtaRgG9+be/yxpSbZynTdbWOVXIkTiUQb8RxURNiOgjmegviseFwvaXn2+EWkYAMcAU4Q3/FQwu19emN71wFPzJrnws+TOKXrgKJDmWk3JjO8Xv0ZJuLB45+oJRNWmZ9xILK8ASEk0pvkgD7AP1mciy/9aCU/yAU8c+8FY2BvAMcZ10HMelVCtFGYX3AQ6lghdn4IpcvRgfHLsL9pzGi1zdpmazm2Yt4/TaxOXgpDqJjOwCLt5A3JMqAdmzRk8MRrioEMtBiUZcAQXjqITrfk=
  - secure: gOXIhVxRR1TFjnzXwJm6GVWZNDYa9WCQPuIHq1/ugFPyGb/80k8joE22nWvK1VxrbdII8nrllDwG5j9DnkjddCi4LoFUKhG4061LMHyXKVoU6UkGcipOEsiEdcnbPNVXZ+rtwNND3irqw8Kkj2KZRGRo28UC+MvMWCwNbm/v6SGFLB+hZIENTF2e/c/P7568rA904S4Q/ZnLjei0ZYOUNj/NnC5EngzMczHSfq4YLNU2b4NQMyCfxrhINM0HOZpIag4v5OWA6WKnmsub4WEMqJx6TdU22MU6t+7fZ5W4g4nmFMGYGJooahWXeAguYAEU4z6LiLS96/IHWUH4HUBSRnadhrrxzWFUxwpL8DCKqP3UUlYcLv1mSQuF7A/PFUkLM7fwGUqA1HYYpekJ/nmJtmKkVxds9/HdATIBAoW+Zy/01Jjk6Su4ajVJzzfyhHKdU9uKZnXHRMranr9Ncur7N7hu95oARxGFfkpv2J7HpgkWCYhYNJlTQSKfz1VAxvmdyVjAJlAa1GLHztL20LqRWQdeCEa2VASRTSp0hci/PXuK5zM07oKGnsBX2NgrJ8AvYzi9wnQkLly2ht5IV1Lk7E7SutUD36HRz8kqpEZGjlP5SCeaj0Z45EJwKY8TprteINJjJsMcitqHKdqtP1YB7RtZm6ICWyHcarB4iO4B6rw=
  - secure: fKQ7qPRhJFS1zeqxwnmtD0MbeJo+p3JcESOCP9k/JvaV2/LEdm+nyyYTdwjFP91zt8CUQ68nOGrwOHbIhQwi9Fuscb8Wma8N4fxFjnD2wDd6roqAwr1fni0pbcHjGimOJoJZkYopOtpMmvrkTB16w6jB8pbduAXB2XhyQhFnrVNfgz659dP1+3o6twNK0579eLpl6+EADMxBFIPrdlEyMV3On4agEWx2z7ra8z7ftvNMYhbNQ3KYAmT45dqZx1khfYRI4zl5cGyMBG3UreCsahN2KdKy9rfkgGjF3Wh3M0ZtRY4wgmemONKt5M03wKYd7tTpqbl8nY+OjZ9VciYpnrp9UTi5zE5LQNNOPe4LBhiSAWwzbHzXxVTJ4Mlm3OjkFHrn1lmEEHTBf7LL9pKGLa3J4bGi1KMTF2ndnifIsrTcWRcopccH8hF+uio4j751Emgd62gbCd78S4J476oKN/fXEtyC7fQA5sWReWUfFNhhEL6yCxteiTlNMlGpQ1vHghsFJ8U5cY8v2cTUo8Scan/cSX9UkuNAHse47sb8F0FVIzl1fumM8ecXsjCoUFh67nH6zYcccp44XNZgQm5NuotNguJ9vECjrCA0NCKfLxtZDbmai0oSyI2SYlNVDpHNkAiscU5lo/FEwKV3wdY7DdU25Bkswl3Hn9uGIGwabdk=
  - secure: ckYBg95VnECfrUcc6MG/yDDs9mfoK9sWsFxbDbx7pCkl++KO4Fd7vcu+xjc2MPzH0YNtXYjM6OOVOxHHp6CLKCgNhTNKVO0gy8J3nx8FDY1qlWE6zIIu8ho4cYFYuXc+xilx04EvNsMPnpF2/8DRR1fRnOWHZexft5SoE3d2r6mLRDkzUQp3dCzQBA/o4+yIhzu8UJ9WF/yIvlyagEOck1dXLRYSbvEndviQcVnwATIWyUb2fEqg4YmwCCJgegTDzh+zydeep0UcAoSi/n3unJHp/3nziGizEdjlgo2mqRe8oF8/uc1Dep9mXfkcbJIMxsEZ73gyadNIjBG8tBU4Zg49vx5mPW8VOqpNJuFdI3Fm6h1c7rt4Ec/jp5OI9ajM53XBLfVZH4pXcKGp3nY/D5ae1CkPoAV79MWmATCS5ohhqna+Iio0wpzzn6X0BQV/HWH37gL4t+kEqbVPVGsGQmZErYsSs8LehMD4kxmpf+KGTnVnbTUwJh3uFgSTpeHKzyF/QyLd2SpTKGa2IqDl7CfdSGvLZaSk0ROGC6WDKFVkDdbArjA/cf9Vv+mRHiQGOPku7qZYFEn9FVp8cwxbsnM1uxRT88fqyWcPqtFOJowXW7KDWTV3Pgrst4bPEImX7LT1FtDmo8+GRFn2lKJUQar4txFx0PGb0B0pmE2Yj+0=
  - secure: HQ10gHo4/NKF3DG29pb+SAAlMl/+Oc4vlttIJxsH/x7wT2dPMRODDoXgXAYO5azAG6TCDeaP15iRzKOicY7Umxk0gjlX6RFjbDhoPGGhvmAwmmhoL22+F0ivXLq4R2kV7DNSDhz74sMwf58f+XGVlMtgtQBpD14WCwcp9U+08icyl5M2DOBLCEVq3pGNpwX+NG+xpwhZ6aH4VallXAqGmrRI8lBZwJZbqR6ojX0VHNoVPb3M7PL7Hg1l12Ek5lOS3C135EvR8d4UyVpOSzR38YTLPa6Xn+fB2k8Bt0CkmdQ2GFeDbq51AGqfW075LVAF8gl6gVxRRMeRRFg5r1dEgEmk69yT6jskNUwIXuFrfqTlkJ9WfQr45/wt0WvR4/zRsB2hmecqG6D5tucqcNNDOgW0ZR49Wx3w6iLXydYA82o0ovvxzjJofx6vDZFxPeYt4cSkHZ7UNEOJJ+wWYtwzTpPh+ENQxOqzeq8EI50wKChVDrCoD+p+83UMohkWZu4xvTuPgi3VWvlvJcJXd0QuvWFVj1cbNDs5O2gMn1jAyRnSuG+moxpyBzDA6BhlnDZH4ISiqRbHyjjJRtzKNxN9xLXWFMckDtbyUeOyFrZE5N/FDYaIRpjzmZCzejFXKcR+D0V9riBcDHlQKGDrkHWlYGEfKcSH5Ne/iOONKytR3vQ=
  - secure: lUsVq2hILohJ588LnSjWddBGTxvvr9QhX/Lv+BgFcHlNUEu2eT2NQ7/MjwlnHhJOHdiDBKuo9lXSc0dxQL6Rs2lyt32gGlrLH0UnVFGp8skmdB6rlwPy4IDShFXAIUznMFCz9Gy+TfMzoJAjdtO4N8AJhJZLjuQyF4Kdm6Vov1tkd4NjT1dyK9X3lRF9LS2KuaWDHkzFQdVgh70R5PI2a1GM/Ws+Wn1hZO3PAtiYbnJyEvae1F8AxwehhbMTPn6MY9i06zVCQVULIq3WSVTCBPvJ9zyEjwbn17enj7bURw9s+2F7bDHIX7X6sALJfn7ABJ4AlESNdDbM7sMG9wBdejeCDhzCrbW+s2wHS93RfL67bebhHl3423uBm8OsWEeuyci/0nwnao8J5C+d+iSDyMW71hAglTTdfgphnAkItQhnTywof6WbDnSm3vaTFq1dk4gWE+udnVZhRvBmKGCGROTre5C2AVQinxRloJIAHigiPfRf1KvXUNwGGDRj07/HUGZR4YT78rpRmVWuQfE5KkwsbgzyRnpf33WgK2YKjRNup7VLR/dDgZQfUb1ITD9uTWOim+WVRhpyuvrwQdmDZCdvZg1kIUSPDiVCKP9oWI5tHT0ePQC0nisAoCX+HNl0LMMskiF/2bOgDh39IfC1oQJEs+m1/aCEKfagIindGDQ=
  - secure: g7WIL5Wln6BWFAUsI7nqsEV2ODyL5A8Uahar60o26eBkveSNvyn8wMXAZ7ZwL9BHJGhsJhvYaw/1Qg45vSkrex5BLZUcVZt3BzXaHzU6ZI/kkXsDVieWMHWz9EENxEmhkRm37pGxfv1I8gXssfhZMHzG5pfgQRGvz5Ad3Slqo1Ev2JREgOCy3Ba5G+rSwPNEVvQlnEvdRjDjby+LtVEGINISjDTitg1miMkvPYcSuLyGtH3WmyYIIheaHwbxpQu+ZYU/yE7HAhTMNXvM7iUgYAB2oF+Cs37sRHXZgwVeiS+Xbt0AHY6gKKiBd20AHmY4512IiO6aSmxykFjswE2FN2j1hkwhNXuLGSbvCbChimoKg/DGvZ6cYMDDCs0zM7x5sJ/3BM7zk6vm7g9krIuS9MZqKECSqHEtQKPvhH0fuCgMv117yOzBo0G2B8Ywi/9UmBA/+Gly3pVPyrmWoSgE0D8tISreHcN9ak61lAYzroPIrtl+/+O87NXKMTl91OS3lnK9kcoFZtGXvR3o8HuAts/zJ+BWe89SJdcH2b8T9Eya1h5gW01VR+uN/1TUJwGaE7omfPCHlgySathMr0iJussbtymsdcoaPPIHxLNwd5BIuowvkCf61mkkPFuryamGClqgH8T4/zl2HrISC+WAlN0/ludzF4LotsUh1uvA0NQ=
  - secure: i646cZeEcLg4XA4snwDshV5X+wYTxYFNOteCg8mLKvaeIrRU3G5V6LGDvran516VmVgalcpBT+dzUrQk2Duak+AdAKsglZ5OQqU3hr0PCtyrLTT22p+rkwRouvdmylYRp29mqvDxcmTXQqC4kPocDhymi3BfKCzkeip6ovHJfbS/4J0iP2slpTSZOLjN6o4p1Cc4ExfSmuV8knB1+onAidTSscOV5QQQW25SAvpxuGnYPNtWSp7PamZI7SEPC2vuUaSA+7l7YoEUvA4tyiI7tYGvoet3lYiNl4wQQRrlhybke+XVniXuDjukpOckY1L4sG9OGKX4r43te20G6kKYoQCaE5FP+aG5Ar0e6Zy4aXDP13hye0rX8GoDXXoa0uTd36tOGlWoHXush7Vevwbfwe0BOMdE6/xTp4OKEzRLh15YKjjQ4wPPEBmWU4Fh9kfw5syHWrfQZZNBr7ZWNK8+pC+Gsj7IsA2vCEdsxeeusNaUnYFN/6RuyvN6g4clHNW14fa+Ga69aTH3t+I3Kp+5mAcmApYztgCYfM2PRYJdnhFi359yGPaKwbtu6Oc+5bzrd7+JV1kUHAEN2OwBcDVR6YHF09mkpsz/bz2abelsCBQ0M34q7hryY7WhWogwcOeS8pnD1K/PabQguQLstnh0FM6jJCQ+NOQ2dgqguUaBB6E=
